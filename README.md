# vocoder
VE1939: EECS 452 MDE final project

The goal of the VE1939 Vocoder was to create an expressive, playable vocoder with a suite of hardware controlled digital effects including distortion, chorus, delay, compression, and sweepable filters.  In addition, the visual design and form factor of the vocoder was made a priority since these are key aspects to designing a stage-ready musical product. 

Nearly all of the goals outlined in the initial project proposal were met. After the project proposal presentation, the first discussion of the scope with faculty and graduate student advisors, the compressor was deemed unnecessary and the effects in general were designated as stretch goals. By Milestone 2, the vocoder had been implemented in real time and non-real time versions of the distortion, chorus, and delay worked as expected. The sweepable filters were in the earliest stages of being implemented using library filter functions.  The final version of the project had a vocoder which improved greatly over Milestone 2’s vocoder, and delay and bit crush distortion are implemented and working as expected. Real time versions of the chorus and sweepable filters were built, but bugs prevented us from launching them on the effects box for demonstration.

The hardware used in the VE1939 includes two TI C5515 ezDSP chips, a Raspberry Pi 2 Model B, an Arduino Mega, a MIDI keyboard, a 7’’ touch screen, and a microphone. The Raspberry Pi is used for synthesis, one C5515 does the vocoder computations, the second C5515 processes effects, and the Mega takes analog inputs from the knobs and faders that are mounted on the box. 

The vocoder algorithm is not much more complex than a simple filter. First, the signal is windowed and we take the Fast Fourier Transform (FFT) of both the synthesized signal from the Raspberry Pi and the speech signal from the microphone input. The magnitude of each signal is multiplied and the phase component of only the synthesized signal is preserved. The inverse transform of this new magnitude and phase combination is taken, the window is applied again, and the result is a vocoded output. 

The distortion, EQ, chorus, and delay effects are all time domain based signal processing. The distortion is a bit crusher, which is a highly efficient distortion method that limits the number of bits representing the signal. The delay is a circular buffer with offset read and write indexes according to the user specified delay time. It also includes a feedback line between the read and write indexes, allowing for multiple repetitions of the sound. The best non-real time prototype of the chorus implements a similar circular buffer and feedback schema, but the distance between the read and write indexes is sinusoidally varying. In order to prevent pops and clicks from the discontinuities this causes, linear interpolation is done between the sampled values.   The EQ design uses a filter bank of three simple direct-form II biquad design with 5 coefficients per filter.  The filters were designed to allow the coefficients to be updated in real time thus giving the user the ability to change filter gain and corner/center frequency for filter sweep effects.

The final VE1939 prototype performed within our initial goals. The latency of the full system was approximately 52 ms, making it entirely feasible to perform without a distracting delay to the musician. Several suitable synthesizer sounds were found to give a rich timbre to the vocoder. The largest problems the VE1939 is still faced with are aliasing and high frequency loss due to the 24kHz sampling rate and the missing EQ and Chorus effects. While the aliasing is minor and the real time EQ and chorus effects are close to complete, the high frequency loss makes intelligibility difficult on the vocoded output since fricatives have a lot of high frequency content. This problem is largely solved with a Wet/Dry knob that allows the performer to add in an amount of non-vocoded output, which has better intelligibility.

